<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>ğŸ“ ìŠ¤ë§ˆíŠ¸ ìê°€ì±„ì </title>
<style>
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
  margin: 0; padding: 0;
  font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
  background: #f4f6f9; min-height: 100vh;
}

/* â”€â”€ í—¤ë” â”€â”€ */
.header {
  background: linear-gradient(135deg, #4F46E5, #7C3AED);
  color: white; padding: 20px 16px 16px; text-align: center;
  position: sticky; top: 0; z-index: 100;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.header h1 { margin: 0 0 6px; font-size: 19px; font-weight: 700; }
.header p  { margin: 0; font-size: 13px; opacity: 0.9; }

/* â”€â”€ ë¬¸ì œ ì¹´ë“œ â”€â”€ */
.problem-wrap { padding: 16px 16px 100px; max-width: 500px; margin: 0 auto; }
.card {
  background: white; border-radius: 16px; padding: 20px;
  margin-bottom: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.04);
  border: 1px solid #edf2f7; transition: all 0.3s ease;
}
.card.correct { border: 2px solid #10B981; background: #F0FDF4; }
.card.wrong   { border: 2px solid #EF4444; background: #FEF2F2; }
.card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.card-num { font-weight: 700; font-size: 15px; color: #374151; background: #F3F4F6; padding: 4px 10px; border-radius: 8px; }
.result-icon { font-size: 20px; font-weight: bold; }

/* â”€â”€ ë‹µ ì…ë ¥ì°½ â”€â”€ */
.ans-input {
  width: 100%; padding: 14px 16px; font-size: 18px; font-weight: bold;
  border: 2px solid #E5E7EB; border-radius: 12px; outline: none;
  transition: all 0.2s; background: #F9FAFB; text-align: center;
}
.ans-input:focus { border-color: #4F46E5; background: white; box-shadow: 0 0 0 3px rgba(79,70,229,0.1); }
.ans-input[disabled] { background: transparent; color: #111827; border-color: transparent; padding: 0; font-size: 24px; }

/* â”€â”€ ìˆ˜ì‹ í€µë²„íŠ¼ ë°” (2ë‹¨ ê³ ì •) â”€â”€ */
.quick-rows { display: flex; flex-direction: column; gap: 8px; margin-top: 12px; }
.quick-row { display: flex; gap: 8px; }
.qb {
  flex: 1; padding: 12px 0; text-align: center;
  background: #EEF2FF; border: 1px solid #C7D2FE;
  border-radius: 8px; font-size: 16px; cursor: pointer;
  color: #4F46E5; font-weight: 600;
  transition: background 0.1s;
  /* ë²„íŠ¼ í„°ì¹˜ ì‹œ í…ìŠ¤íŠ¸ ì»¤ì„œ(í‚¤ë³´ë“œ)ê°€ ì‚¬ë¼ì§€ëŠ” í˜„ìƒ ë°©ì§€ */
  touch-action: manipulation;
}
.qb:active { background: #C7D2FE; }

/* â”€â”€ í•˜ë‹¨ ê³ ì • ë²„íŠ¼ â”€â”€ */
#submit-bar {
  position: fixed; bottom: 0; left: 0; width: 100%;
  padding: 12px 16px 24px; background: rgba(255,255,255,0.9);
  backdrop-filter: blur(10px); border-top: 1px solid #E5E7EB; z-index: 90;
}
.btn-primary {
  width: 100%; max-width: 500px; margin: 0 auto; display: block;
  padding: 16px; font-size: 17px; font-weight: bold;
  background: linear-gradient(135deg, #4F46E5, #7C3AED);
  color: white; border: none; border-radius: 14px; cursor: pointer;
  box-shadow: 0 4px 12px rgba(79,70,229,0.3); transition: transform 0.1s;
}
.btn-primary:active { transform: scale(0.98); }

/* â”€â”€ ê²°ê³¼ í™”ë©´ â”€â”€ */
#result-screen { display: none; max-width: 500px; margin: 0 auto; padding: 40px 20px 80px; text-align: center; }
.score-circle {
  width: 140px; height: 140px; border-radius: 50%;
  background: linear-gradient(135deg, #10B981, #059669);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  margin: 0 auto 24px; box-shadow: 0 8px 24px rgba(16,185,129,0.3); color: white;
}
.score-num { font-size: 48px; font-weight: 800; line-height: 1; }
.score-label { font-size: 14px; opacity: 0.9; margin-top: 4px; }
.score-msg { font-size: 24px; font-weight: 800; margin-bottom: 30px; color: #111827; }

.btn-retry {
  width: 100%; padding: 18px; font-size: 17px; font-weight: bold;
  background: #F59E0B; color: white; border: none; border-radius: 14px; cursor: pointer;
  box-shadow: 0 4px 12px rgba(245,158,11,0.3);
}
</style>
</head>
<body>

<div class="header">
  <h1 id="hTitle">ğŸ“ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h1>
  <p id="hSub">QR ì½”ë“œë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
</div>

<div id="loading" style="padding:80px 20px;text-align:center;color:#6B7280;">
  <div style="font-size:48px;margin-bottom:16px; animation: spin 2s linear infinite;">â³</div>
  <div style="font-size: 16px; font-weight: bold;">ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<div id="error" style="display:none;padding:80px 20px;text-align:center;color:#EF4444;">
  <div style="font-size:48px;margin-bottom:16px;">âš ï¸</div>
  <div id="errorMsg" style="font-size: 16px; font-weight: bold;">ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
</div>

<div id="main" style="display:none;">
  <div class="problem-wrap" id="problemWrap"></div>
  <div id="submit-bar"><button class="btn-primary" onclick="submitAll()">âœ… ì±„ì  ì™„ë£Œí•˜ê¸°</button></div>
</div>

<div id="result-screen">
  <div class="score-circle">
    <div class="score-num" id="rScore"></div>
    <div class="score-label" id="rTotal"></div>
  </div>
  <div class="score-msg" id="rMsg"></div>
  
  <p style="color: #6B7280; margin-bottom: 20px; line-height: 1.6;">
    ì •ë‹µì„ ë§ì¶˜ ë¬¸ì œëŠ” ì´ˆë¡ìƒ‰ìœ¼ë¡œ ì ê¸ˆ ì²˜ë¦¬ë©ë‹ˆë‹¤.<br>í‹€ë¦° ë¬¸ì œëŠ” ë‹¤ì‹œ í’€ì–´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
  </p>
  
  <button class="btn-retry" onclick="retryAll()">ğŸ”„ í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œ í’€ê¸°</button>
</div>

<script>
let examData = null;

// â”€â”€ í€µë²„íŠ¼ ì •ì˜ (2ë‹¨ ë¶„ë¦¬) â”€â”€
const ROW1 = [['â‘ ','â‘ '], ['â‘¡','â‘¡'], ['â‘¢','â‘¢'], ['â‘£','â‘£'], ['â‘¤','â‘¤']];
const ROW2 = [['âˆš','âˆš'], ['Â²','Â²'], ['Â³','Â³'], ['ë¶„ìˆ˜(/)','/'], ['Ï€','Ï€']];

// â”€â”€ ì´ˆê¸°í™” â”€â”€
(async function init() {
  const id = new URLSearchParams(location.search).get('id');
  if (!id) { showError('QR ì½”ë“œ ì •ë³´ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.'); return; }
  const base = location.href.replace(/\/grading\.html.*$/, '');
  
  try {
    const res = await fetch(base + '/answers/' + id + '.json');
    if (!res.ok) throw new Error('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    examData = await res.json();
    renderProblems();
  } catch(e) {
    showError('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
  }
})();

function showError(msg) {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('error').style.display = 'block';
  document.getElementById('errorMsg').innerHTML = msg;
}

// â”€â”€ ë¬¸ì œ ë Œë”ë§ â”€â”€
function renderProblems() {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('hTitle').textContent = examData.title;
  document.getElementById('hSub').textContent = 'ğŸ‘¤ ' + examData.student + ' | ğŸ“… ' + (examData.date || '');

  const wrap = document.getElementById('problemWrap');
  let html = '';

  // ë²„íŠ¼ HTML ìƒì„±ê¸° (onmousedownì„ ì¨ì•¼ í…ìŠ¤íŠ¸ë°•ìŠ¤ í¬ì»¤ìŠ¤ê°€ ë‚ ì•„ê°€ì§€ ì•ŠìŒ)
  const genRow = (arr, pNum) => arr.map(([label, val]) =>
    `<button type="button" class="qb" onmousedown="event.preventDefault();" onclick="insertQuick('inp_${pNum}','${val}')">${label}</button>`
  ).join('');

  examData.problems.forEach(p => {
    html += `
      <div class="card" id="card_${p.number}">
        <div class="card-header">
          <div class="card-num">${p.number}ë²ˆ</div>
          <div class="result-icon" id="icon_${p.number}"></div>
        </div>
        <input class="ans-input" id="inp_${p.number}" type="text" placeholder="ì •ë‹µ ì…ë ¥" autocomplete="off" autocorrect="off" spellcheck="false">
        
        <div class="quick-rows" id="qb_${p.number}">
          <div class="quick-row">${genRow(ROW1, p.number)}</div>
          <div class="quick-row">${genRow(ROW2, p.number)}</div>
        </div>
      </div>`;
  });

  wrap.innerHTML = html;
  document.getElementById('main').style.display = 'block';
}

// â”€â”€ í€µë²„íŠ¼ ì‚½ì… â”€â”€
function insertQuick(inputId, val) {
  const el = document.getElementById(inputId);
  if (!el || el.disabled) return;
  
  const start = el.selectionStart || el.value.length;
  const end = el.selectionEnd || el.value.length;
  const v = el.value;
  
  el.value = v.slice(0, start) + val + v.slice(end);
  el.setSelectionRange(start + val.length, start + val.length);
  el.focus();
}

// â”€â”€ ì •ê·œí™” (ì±„ì ìš©) â”€â”€
function norm(s) {
  if (!s && s !== 0) return '';
  return s.toString().trim().toLowerCase()
    .replace(/\s+/g, '')
    .replace(/\^2/g, 'Â²').replace(/\^3/g, 'Â³')
    .replace(/Ã—/g,'*').replace(/Ã·/g,'/')
    .replace(/[ï¼ˆ(]/g,'(').replace(/[ï¼‰)]/g,')')
    .replace(/[ï¼Œ,]/g,',').replace(/ï¼/g,'-').replace(/ï¼‹/g,'+')
    .replace(/â‘ /g,'1').replace(/â‘¡/g,'2').replace(/â‘¢/g,'3')
    .replace(/â‘£/g,'4').replace(/â‘¤/g,'5');
}

// â”€â”€ ì±„ì í•˜ê¸° â”€â”€
function submitAll() {
  if (!examData) return;
  let correct = 0;

  examData.problems.forEach(p => {
    const inp = document.getElementById('inp_' + p.number);
    const card = document.getElementById('card_' + p.number);
    const icon = document.getElementById('icon_' + p.number);
    const qb = document.getElementById('qb_' + p.number); // ìˆ˜ì‹ ë²„íŠ¼ ì˜ì—­

    const userAns = inp ? inp.value.trim() : '';
    const corrAns = p.answer || '';
    const ok = corrAns && norm(userAns) === norm(corrAns);

    if (ok) correct++;
    
    // UI ì—…ë°ì´íŠ¸
    card.className = 'card ' + (ok ? 'correct' : 'wrong');
    icon.textContent = ok ? 'âœ…' : 'âŒ';
    icon.style.color = ok ? '#10B981' : '#EF4444';
    
    // ì±„ì ì´ ëë‚˜ë©´ ë¬´ì¡°ê±´ ì…ë ¥ì°½ ì ê·¸ê³  ìˆ˜ì‹ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
    if (inp) inp.disabled = true;
    if (qb) qb.style.display = 'none';
  });

  const total = examData.problems.length;
  const pct = Math.round(correct / total * 100);
  
  document.getElementById('rScore').textContent = correct;
  document.getElementById('rTotal').textContent = '/ ' + total + 'ë¬¸ì œ ì •ë‹µ';
  document.getElementById('rMsg').textContent =
    pct >= 90 ? 'ğŸ‰ ì™„ë²½í•´ìš”!' :
    pct >= 70 ? 'ğŸ‘ ì˜í–ˆì–´ìš”!' :
    pct >= 50 ? 'ğŸ’ª ì¡°ê¸ˆ ë” ë…¸ë ¥í•´ë´ìš”!' : 'ğŸ˜Š ë‹¤ì‹œ ë„ì „í•´ë´ìš”!';

  document.getElementById('main').style.display = 'none';
  document.getElementById('result-screen').style.display = 'block';
  window.scrollTo({top:0, behavior:'smooth'});
}

// â”€â”€ í‹€ë¦° ë¬¸ì œë§Œ ë‹¤ì‹œ í’€ê¸° â”€â”€
function retryAll() {
  examData.problems.forEach(p => {
    const inp = document.getElementById('inp_' + p.number);
    const card = document.getElementById('card_' + p.number);
    const icon = document.getElementById('icon_' + p.number);
    const qb = document.getElementById('qb_' + p.number);
    
    // "wrong" í´ë˜ìŠ¤(í‹€ë¦° ë¬¸ì œ)ì¸ ì¹´ë“œë§Œ í™œì„±í™” (ë§ì¶˜ ê±´ ê±´ë“œë¦¬ì§€ ì•ŠìŒ)
    if (card && card.classList.contains('wrong')) {
      if (inp) { inp.value = ''; inp.disabled = false; }
      card.className = 'card';
      if (icon) icon.textContent = '';
      if (qb) qb.style.display = 'flex'; // ìˆ¨ê²¼ë˜ ìˆ˜ì‹ ë²„íŠ¼ ë‹¤ì‹œ ë³´ì—¬ì£¼ê¸°
    }
  });
  
  document.getElementById('result-screen').style.display = 'none';
  document.getElementById('main').style.display = 'block';
  window.scrollTo({top:0, behavior:'smooth'});
}
</script>
</body>
</html>
