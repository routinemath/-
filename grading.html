<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>ğŸ“ ìê°€ì±„ì </title>
<style>
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin: 0; padding: 0; font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background: #f0f2f5; min-height: 100vh; }

/* í—¤ë” */
.header {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white; padding: 16px 16px 12px;
  text-align: center;
}
.header h1 { margin: 0 0 4px; font-size: 18px; }
.header p  { margin: 0; font-size: 12px; opacity: .8; }

/* ë¡œë”© / ì—ëŸ¬ */
#loading, #error {
  text-align: center; padding: 60px 20px; color: #888;
}
#error { color: #e53935; }

/* ë¬¸ì œ ì¹´ë“œ */
.problem-wrap { padding: 12px 12px 80px; max-width: 480px; margin: 0 auto; }

.card {
  background: white; border-radius: 12px; padding: 14px;
  margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,.07);
  border-left: 4px solid #ddd; transition: border-color .3s, background .3s;
}
.card.correct { border-left-color: #4CAF50; background: #f0fff4; }
.card.wrong   { border-left-color: #f44336; background: #fff5f5; }

.card-num { font-weight: bold; font-size: 13px; color: #555; margin-bottom: 8px; }

/* ë‹µ ì…ë ¥ì°½ + ê²°ê³¼ ë±ƒì§€ í–‰ */
.input-row { display: flex; gap: 8px; align-items: center; }
.ans-input {
  flex: 1; padding: 10px 12px; font-size: 16px;
  border: 2px solid #ddd; border-radius: 8px; outline: none;
  transition: border-color .2s; background: white;
  cursor: pointer;
}
.ans-input:focus { border-color: #667eea; }
.ans-input[disabled] { background: #fafafa; color: #333; cursor: default; }
.result-icon { font-size: 22px; min-width: 28px; text-align: center; }
.wrong-ans { font-size: 11px; color: #e53935; margin-top: 5px; font-weight: bold; }

/* ìˆ˜ì‹ í‚¤íŒ¨ë“œ */
#keypad-overlay {
  position: fixed; bottom: 0; left: 0; width: 100%; z-index: 100;
  background: #f7f7f7; border-top: 1px solid #ddd;
  padding: 8px 6px 10px; display: none;
}
#keypad-overlay.visible { display: block; }

.keypad-tabs {
  display: flex; gap: 4px; margin-bottom: 6px;
}
.kp-tab {
  padding: 5px 12px; border: 1px solid #ccc; border-radius: 20px;
  background: white; font-size: 13px; cursor: pointer;
}
.kp-tab.active { background: #667eea; color: white; border-color: #667eea; }

.keypad-grid {
  display: none; grid-template-columns: repeat(5, 1fr); gap: 4px;
}
.keypad-grid.active { display: grid; }

.kp-btn {
  padding: 10px 4px; background: white; border: 1px solid #ddd;
  border-radius: 8px; font-size: 15px; cursor: pointer;
  text-align: center; user-select: none;
  box-shadow: 0 1px 3px rgba(0,0,0,.08);
  transition: background .1s;
}
.kp-btn:active { background: #e8eaff; }
.kp-btn.del  { background: #ffebee; color: #e53935; }
.kp-btn.done { background: #667eea; color: white; grid-column: span 2; }
.kp-btn.sp   { background: #f0f0f0; }

/* ì±„ì  ë²„íŠ¼ (ê³ ì • í•˜ë‹¨) */
#submit-bar {
  position: fixed; bottom: 0; left: 0; width: 100%;
  padding: 10px 16px 14px; background: white;
  border-top: 1px solid #eee; z-index: 90;
}
#submit-bar button {
  width: 100%; padding: 14px; font-size: 16px; font-weight: bold;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white; border: none; border-radius: 10px; cursor: pointer;
}

/* ê²°ê³¼ í™”ë©´ */
#result-screen {
  display: none; max-width: 480px; margin: 0 auto; padding: 20px 16px 80px;
  text-align: center;
}
.score-circle {
  width: 130px; height: 130px; border-radius: 50%;
  background: linear-gradient(135deg, #667eea, #764ba2);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  margin: 0 auto 16px;
  box-shadow: 0 6px 20px rgba(102,126,234,.4);
}
.score-num   { font-size: 42px; font-weight: bold; color: white; line-height: 1; }
.score-label { font-size: 13px; color: rgba(255,255,255,.8); margin-top: 3px; }
.score-msg   { font-size: 20px; font-weight: bold; margin: 0 0 16px; }
.result-list { text-align: left; background: white; border-radius: 12px; padding: 4px 16px; margin-bottom: 16px; }
.result-row  { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
.result-row:last-child { border-bottom: none; }
.tag-ok  { color: #4CAF50; font-weight: bold; }
.tag-ng  { color: #f44336; font-weight: bold; }

.btn-retry {
  width: 100%; max-width: 480px; padding: 14px; font-size: 15px;
  background: #FF9800; color: white; border: none; border-radius: 10px;
  cursor: pointer; margin: 0 auto; display: block;
}
</style>
</head>
<body>

<div class="header">
  <h1 id="hTitle">ğŸ“ ìê°€ì±„ì </h1>
  <p  id="hSub">ë¡œë”© ì¤‘...</p>
</div>

<div id="loading" style="padding:60px 20px;text-align:center;color:#888;">
  <div style="font-size:40px;margin-bottom:12px;">â³</div>
  <div>ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<div id="error" style="display:none;padding:60px 20px;text-align:center;color:#e53935;">
  <div style="font-size:40px;margin-bottom:12px;">âš ï¸</div>
  <div id="errorMsg">ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
  <div style="font-size:12px;color:#aaa;margin-top:8px;">URLì„ í™•ì¸í•˜ê±°ë‚˜ ì„ ìƒë‹˜ê»˜ ë¬¸ì˜í•˜ì„¸ìš”.</div>
</div>

<div id="main" style="display:none;">
  <div class="problem-wrap" id="problemWrap"></div>

  <div id="submit-bar">
    <button onclick="submitAll()">âœ… ì±„ì í•˜ê¸°</button>
  </div>
</div>

<div id="result-screen">
  <div class="score-circle">
    <div class="score-num"  id="rScore"></div>
    <div class="score-label" id="rTotal"></div>
  </div>
  <div class="score-msg" id="rMsg"></div>
  <div class="result-list" id="rList"></div>
  <button class="btn-retry" onclick="retryAll()">ğŸ”„ ë‹¤ì‹œ í’€ê¸°</button>
</div>

<!-- ìˆ˜ì‹ í‚¤íŒ¨ë“œ -->
<div id="keypad-overlay">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; padding:0 4px;">
    <div class="keypad-tabs">
      <button class="kp-tab active" onclick="switchTab('num')">ìˆ«ì</button>
      <button class="kp-tab"       onclick="switchTab('frac')">ë¶„ìˆ˜/ë£¨íŠ¸</button>
      <button class="kp-tab"       onclick="switchTab('sym')">ê¸°í˜¸</button>
    </div>
    <button onclick="hideKeypad()" style="padding:5px 10px;border:1px solid #ccc;border-radius:6px;background:white;font-size:13px;cursor:pointer;">âœ• ë‹«ê¸°</button>
  </div>

  <!-- ìˆ«ì íƒ­ -->
  <div class="keypad-grid active" id="tab-num">
    <button class="kp-btn" onclick="ins('7')">7</button>
    <button class="kp-btn" onclick="ins('8')">8</button>
    <button class="kp-btn" onclick="ins('9')">9</button>
    <button class="kp-btn sp" onclick="ins('+')">ï¼‹</button>
    <button class="kp-btn del" onclick="del()">âŒ«</button>

    <button class="kp-btn" onclick="ins('4')">4</button>
    <button class="kp-btn" onclick="ins('5')">5</button>
    <button class="kp-btn" onclick="ins('6')">6</button>
    <button class="kp-btn sp" onclick="ins('-')">ï¼</button>
    <button class="kp-btn sp" onclick="ins('.')">ï¼</button>

    <button class="kp-btn" onclick="ins('1')">1</button>
    <button class="kp-btn" onclick="ins('2')">2</button>
    <button class="kp-btn" onclick="ins('3')">3</button>
    <button class="kp-btn sp" onclick="ins('Ã—')">Ã—</button>
    <button class="kp-btn sp" onclick="ins('Ã·')">Ã·</button>

    <button class="kp-btn" onclick="ins('0')" style="grid-column:span 2">0</button>
    <button class="kp-btn sp" onclick="ins('(')">ï¼ˆ</button>
    <button class="kp-btn sp" onclick="ins(')')">ï¼‰</button>
    <button class="kp-btn done" onclick="hideKeypad()">ì™„ë£Œ âœ“</button>
  </div>

  <!-- ë¶„ìˆ˜/ë£¨íŠ¸ íƒ­ -->
  <div class="keypad-grid" id="tab-frac">
    <button class="kp-btn" onclick="ins('1/2')">Â½</button>
    <button class="kp-btn" onclick="ins('1/3')">â…“</button>
    <button class="kp-btn" onclick="ins('1/4')">Â¼</button>
    <button class="kp-btn" onclick="ins('2/3')">â…”</button>
    <button class="kp-btn" onclick="ins('3/4')">Â¾</button>

    <button class="kp-btn" onclick="ins('/')">ï¼<br><span style="font-size:10px">ë¶„ìˆ˜</span></button>
    <button class="kp-btn" onclick="ins('âˆš')">âˆš</button>
    <button class="kp-btn" onclick="ins('âˆš2')">âˆš2</button>
    <button class="kp-btn" onclick="ins('âˆš3')">âˆš3</button>
    <button class="kp-btn" onclick="ins('âˆš5')">âˆš5</button>

    <button class="kp-btn" onclick="ins('Â²')">xÂ²</button>
    <button class="kp-btn" onclick="ins('Â³')">xÂ³</button>
    <button class="kp-btn" onclick="ins('â»Â¹')">xâ»Â¹</button>
    <button class="kp-btn" onclick="ins('Ï€')">Ï€</button>
    <button class="kp-btn del" onclick="del()">âŒ«</button>

    <button class="kp-btn sp" onclick="ins('2âˆš')">2âˆš</button>
    <button class="kp-btn sp" onclick="ins('3âˆš')">3âˆš</button>
    <button class="kp-btn sp" onclick="ins('âˆ')">âˆ</button>
    <button class="kp-btn sp" onclick="ins('^')">^<br><span style="font-size:10px">ì§€ìˆ˜</span></button>
    <button class="kp-btn done" onclick="hideKeypad()">ì™„ë£Œ âœ“</button>
  </div>

  <!-- ê¸°í˜¸ íƒ­ -->
  <div class="keypad-grid" id="tab-sym">
    <button class="kp-btn" onclick="ins('â‘ ')">â‘ </button>
    <button class="kp-btn" onclick="ins('â‘¡')">â‘¡</button>
    <button class="kp-btn" onclick="ins('â‘¢')">â‘¢</button>
    <button class="kp-btn" onclick="ins('â‘£')">â‘£</button>
    <button class="kp-btn" onclick="ins('â‘¤')">â‘¤</button>

    <button class="kp-btn sp" onclick="ins('x')">x</button>
    <button class="kp-btn sp" onclick="ins('y')">y</button>
    <button class="kp-btn sp" onclick="ins('n')">n</button>
    <button class="kp-btn sp" onclick="ins('a')">a</button>
    <button class="kp-btn sp" onclick="ins('b')">b</button>

    <button class="kp-btn sp" onclick="ins('â‰¤')">â‰¤</button>
    <button class="kp-btn sp" onclick="ins('â‰¥')">â‰¥</button>
    <button class="kp-btn sp" onclick="ins('â‰ ')">â‰ </button>
    <button class="kp-btn sp" onclick="ins('âˆˆ')">âˆˆ</button>
    <button class="kp-btn del" onclick="del()">âŒ«</button>

    <button class="kp-btn sp" onclick="ins('{')">ï½›</button>
    <button class="kp-btn sp" onclick="ins('}')">ï½</button>
    <button class="kp-btn sp" onclick="ins('|')">ï½œ</button>
    <button class="kp-btn sp" onclick="ins(',')">ï¼Œ</button>
    <button class="kp-btn done" onclick="hideKeypad()">ì™„ë£Œ âœ“</button>
  </div>
</div>

<script>
// â”€â”€â”€ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let examData  = null;   // { title, student, date, problems: [{number,answer}] }
let activeInput = null; // í˜„ì¬ í¬ì»¤ìŠ¤ëœ input ìš”ì†Œ

// â”€â”€â”€ ì´ˆê¸°í™”: URLì—ì„œ id íŒŒë¼ë¯¸í„°ë¡œ JSON ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€
(async function init() {
  const params = new URLSearchParams(location.search);
  const id = params.get('id');
  if (!id) { showError('QR ì½”ë“œì— ë¬¸ì œ IDê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

  // GitHub Pagesì—ì„œ JSON íŒŒì¼ ë¡œë“œ
  // í˜„ì¬ í˜ì´ì§€ì™€ ê°™ì€ ì €ì¥ì†Œì˜ answers/{id}.json ì—ì„œ ì½ìŒ
  const base = location.href.replace(/\/grading\.html.*$/, '');
  const jsonUrl = base + '/answers/' + id + '.json';

  try {
    const res = await fetch(jsonUrl);
    if (!res.ok) throw new Error('HTTP ' + res.status);
    examData = await res.json();
    renderProblems();
  } catch(e) {
    showError('ë¬¸ì œ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><small>' + e.message + '</small>');
  }
})();

function showError(msg) {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('error').style.display = 'block';
  document.getElementById('errorMsg').innerHTML = msg;
}

// â”€â”€â”€ ë¬¸ì œ ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderProblems() {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('hTitle').textContent = 'ğŸ“ ' + examData.title;
  document.getElementById('hSub').textContent   = 'í•™ìƒ: ' + examData.student + ' | ' + (examData.date || '');

  const wrap = document.getElementById('problemWrap');
  wrap.innerHTML = '';

  examData.problems.forEach(p => {
    const card = document.createElement('div');
    card.className = 'card';
    card.id = 'card_' + p.number;
    card.innerHTML = `
      <div class="card-num">ë¬¸ì œ ${p.number}ë²ˆ</div>
      <div class="input-row">
        <input class="ans-input" id="inp_${p.number}" readonly placeholder="íƒ­í•˜ì—¬ ë‹µ ì…ë ¥"
          value="" autocomplete="off">
        <span class="result-icon" id="icon_${p.number}"></span>
      </div>
      <div class="wrong-ans" id="wrong_${p.number}" style="display:none"></div>
    `;
    // ì…ë ¥ í•„ë“œ í´ë¦­ ì‹œ í‚¤íŒ¨ë“œ ì—´ê¸°
    card.querySelector('.ans-input').addEventListener('click', function() {
      openKeypad(this);
    });
    wrap.appendChild(card);
  });

  document.getElementById('main').style.display = 'block';
}

// â”€â”€â”€ ìˆ˜ì‹ í‚¤íŒ¨ë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openKeypad(inputEl) {
  activeInput = inputEl;
  document.getElementById('keypad-overlay').classList.add('visible');
  document.getElementById('submit-bar').style.display = 'none';
  // ì¹´ë“œê°€ í‚¤íŒ¨ë“œì— ê°€ë¦¬ì§€ ì•Šë„ë¡ ìŠ¤í¬ë¡¤
  setTimeout(() => {
    inputEl.closest('.card').scrollIntoView({ behavior: 'smooth', block: 'center' });
  }, 150);
}
function hideKeypad() {
  document.getElementById('keypad-overlay').classList.remove('visible');
  document.getElementById('submit-bar').style.display = 'block';
  activeInput = null;
}
function switchTab(tab) {
  document.querySelectorAll('.keypad-grid').forEach(g => g.classList.remove('active'));
  document.querySelectorAll('.kp-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  event.target.classList.add('active');
}
function ins(char) {
  if (!activeInput) return;
  const pos = activeInput.selectionStart ?? activeInput.value.length;
  const v = activeInput.value;
  activeInput.value = v.slice(0, pos) + char + v.slice(pos);
  const newPos = pos + char.length;
  activeInput.setSelectionRange(newPos, newPos);
  activeInput.focus();
}
function del() {
  if (!activeInput) return;
  const pos = activeInput.selectionStart ?? activeInput.value.length;
  if (pos === 0) return;
  const v = activeInput.value;
  activeInput.value = v.slice(0, pos - 1) + v.slice(pos);
  activeInput.setSelectionRange(pos - 1, pos - 1);
}

// í‚¤íŒ¨ë“œ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
document.addEventListener('click', function(e) {
  const overlay = document.getElementById('keypad-overlay');
  if (!overlay.classList.contains('visible')) return;
  if (overlay.contains(e.target)) return;
  if (e.target.classList.contains('ans-input')) return;
  hideKeypad();
});

// â”€â”€â”€ ì •ê·œí™” (ì±„ì  ë¹„êµìš©) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function norm(s) {
  if (s === null || s === undefined) return '';
  return s.toString()
    .trim()
    .toLowerCase()
    .replace(/\s+/g, '')        // ê³µë°± ì œê±°
    .replace(/Ã—/g, '*')
    .replace(/Ã·/g, '/')
    .replace(/[ï¼ˆ(]/g, '(')
    .replace(/[ï¼‰)]/g, ')')
    .replace(/ï¼Œ/g, ',')
    .replace(/ï¼/g, '-')
    .replace(/ï¼‹/g, '+')
    .replace(/[â‘ ]/g, '1').replace(/[â‘¡]/g, '2').replace(/[â‘¢]/g, '3')
    .replace(/[â‘£]/g, '4').replace(/[â‘¤]/g, '5');
}

// â”€â”€â”€ ì±„ì  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function submitAll() {
  if (!examData) return;
  hideKeypad();

  let correct = 0;
  let listHTML = '';

  examData.problems.forEach(p => {
    const inp     = document.getElementById('inp_'  + p.number);
    const card    = document.getElementById('card_' + p.number);
    const icon    = document.getElementById('icon_' + p.number);
    const wrongEl = document.getElementById('wrong_'+ p.number);

    const userAns    = inp ? inp.value.trim() : '';
    const correctAns = p.answer || '';
    const ok = correctAns && norm(userAns) === norm(correctAns);

    if (ok) correct++;

    card.className = 'card ' + (ok ? 'correct' : 'wrong');
    icon.textContent = ok ? 'âœ…' : 'âŒ';
    if (inp) inp.disabled = true;

    if (!ok && correctAns) {
      wrongEl.textContent = 'ì •ë‹µ: ' + correctAns;
      wrongEl.style.display = 'block';
    }

    listHTML += `
      <div class="result-row">
        <span>${p.number}ë²ˆ</span>
        <span class="${ok ? 'tag-ok' : 'tag-ng'}">${ok ? 'âœ… ì •ë‹µ' : 'âŒ ' + (correctAns || 'ì •ë‹µì—†ìŒ')}</span>
      </div>`;
  });

  // ê²°ê³¼ í‘œì‹œ
  const total = examData.problems.length;
  const pct   = Math.round(correct / total * 100);
  document.getElementById('rScore').textContent = correct;
  document.getElementById('rTotal').textContent = '/ ' + total + 'ë¬¸ì œ';
  document.getElementById('rMsg').textContent   =
    pct >= 90 ? 'ğŸ‰ ì™„ë²½í•´ìš”!' :
    pct >= 70 ? 'ğŸ‘ ì˜í–ˆì–´ìš”!' :
    pct >= 50 ? 'ğŸ’ª ì¡°ê¸ˆ ë” ë…¸ë ¥í•´ë´ìš”!' : 'ğŸ˜Š ë‹¤ì‹œ ë„ì „í•´ë´ìš”!';
  document.getElementById('rList').innerHTML = listHTML;

  document.getElementById('main').style.display = 'none';
  document.getElementById('submit-bar').style.display = 'none';
  document.getElementById('result-screen').style.display = 'block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â”€â”€â”€ ë‹¤ì‹œ í’€ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function retryAll() {
  if (!examData) return;
  examData.problems.forEach(p => {
    const inp     = document.getElementById('inp_'  + p.number);
    const card    = document.getElementById('card_' + p.number);
    const icon    = document.getElementById('icon_' + p.number);
    const wrongEl = document.getElementById('wrong_'+ p.number);
    if (inp)     { inp.value = ''; inp.disabled = false; }
    if (card)    card.className = 'card';
    if (icon)    icon.textContent = '';
    if (wrongEl) wrongEl.style.display = 'none';
  });
  document.getElementById('result-screen').style.display = 'none';
  document.getElementById('main').style.display = 'block';
  document.getElementById('submit-bar').style.display = 'block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
</script>
</body>
</html>
